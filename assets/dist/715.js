/*! For license information please see 715.js.LICENSE.txt */
"use strict";(self.webpackChunkTheme_One=self.webpackChunkTheme_One||[]).push([[715],{4901:(e,t,s)=>{s.d(t,{H:()=>l}),salla.event.setMaxListeners(20);class i extends salla.AppHelpers{setHost(e){this.host=e}getElement(e){return this.host.querySelector(e)}getAttribute(e,t){var s;return null===(s=this.getElement(e))||void 0===s?void 0:s.getAttribute(t)}val(e){return this.getAttribute(e,"value")}isUser(){return"user"===salla.config.get("user.type")}}const l=new i},3715:(e,t,s)=>{s.r(t),s.d(t,{salla_verify:()=>a});var i=s(2704),l=s(4901);const a=class{constructor(e){(0,i.r)(this,e),this.verified=(0,i.c)(this,"verified",7),this.initiated=!1,this.display="modal",this.type="mobile",this.autoReload=!0,this.resendAfter=30,this.isProfileVerify=!1,salla.lang.onLoaded((()=>{var e,t;this.title=salla.lang.get("pages.profile.verify_title")+salla.lang.get("common.elements."+this.type),null===(e=this.modal)||void 0===e||e.setTitle(this.title),null===(t=this.btn)||void 0===t||t.setText(salla.lang.get("pages.profile.verify"))})),"inline"!=this.display?(salla.event.on("profile::verification",(e=>{var t;this.isProfileVerify=!0,this.open(e),this.title=salla.lang.get("pages.profile.verify_title")+salla.lang.get("common.elements."+e.type),null===(t=this.modal)||void 0===t||t.setTitle(this.title)})),salla.event.on("modalClosed",(()=>{this.resendAfter=0,this.timer.innerHTML="30 : 00"}))):this.modal={open:()=>"",close:()=>"",setTitle:()=>""}}async getCode(){return this.code.value}async open(e){var t;this.data=e,this.data.type=this.data.type||this.type,this.type=this.data.type,this.resendTimer(),this.otpInputs=this.body.querySelectorAll(".s-verify-input"),this.initiated||(l.H.on("input",".s-verify-input",(e=>salla.helpers.inputDigitsOnly(e.target))),l.H.onKeyUp(".s-verify-input",(e=>{var t,s,i,l;let a=e.keyCode||e.charCode;e.target.value?(null===(t=e.target.nextElementSibling)||void 0===t||t.focus(),null===(s=e.target.nextElementSibling)||void 0===s||s.select()):[8,46].includes(a)&&(null===(i=e.target.previousElementSibling)||void 0===i||i.focus(),null===(l=e.target.previousElementSibling)||void 0===l||l.select()),this.toggleOTPSubmit()})),l.H.on("paste",".s-verify-input",(e=>{let t=salla.helpers.number(e.clipboardData.getData("text")).replace(/[^0-9.]/g,"").replace("..",".");this.otpInputs.forEach(((e,s)=>e.value=t[s]||"")),this.toggleOTPSubmit(),setTimeout((()=>this.otpInputs[3].focus()),100)})),this.initiated=!0),this.reset(),"modal"==this.display&&(null===(t=this.modal)||void 0===t||t.setTitle(this.title)),this.modal.open(),setTimeout((()=>this.otpInputs[0].focus()),100)}toggleOTPSubmit(){let e=[];if(this.otpInputs.forEach((t=>t.value&&e.push(t.value))),this.code.value=e.join(""),4===e.length)return this.btn.removeAttribute("disabled"),void this.btn.click();this.btn.setAttribute("disabled","")}reset(){this.otpInputs.forEach((e=>e.value="")),this.code.value="",this.otpInputs[0].focus()}resendTimer(){l.H.showElement(this.resendMessage).hideElement(this.resend),this.resendAfter=30;let e=setInterval((()=>{this.resendAfter<=0?(clearInterval(e),l.H.hideElement(this.resendMessage).showElement(this.resend)):(this.timer.innerHTML=`${this.resendAfter>=10?this.resendAfter:"0"+this.resendAfter} : 00`,this.resendAfter--)}),1e3)}resendCode(){return this.btn.stop().then((()=>this.btn.disable())).then((()=>{this.otpInputs.forEach((e=>e.value="")),this.otpInputs[0].focus()})).then((()=>salla.api.auth.resend(this.data))).finally((()=>this.resendTimer()))}submit(){let e=Object.assign({code:this.code.value},this.data);return this.btn.load().then((()=>this.btn.disable())).then((()=>this.isProfileVerify?salla.profile.verify(e):salla.auth.verify(e,!0))).then((e=>this.verified.emit(e))).then((()=>this.btn.stop()&&this.btn.disable())).then((()=>this.modal.close())).then((()=>this.autoReload&&window.location.reload())).catch((()=>this.btn.stop()&&this.btn.enable()&&this.reset()))}render(){return"inline"==this.display?(0,i.h)(i.H,null,this.myBody()):(0,i.h)("salla-modal",{icon:"sicon-android-phone",width:"xs",class:"s-verify",ref:e=>this.modal=e,"modal-title":this.title},this.myBody())}myBody(){return(0,i.h)("div",{class:"s-verify-body",ref:e=>this.body=e},(0,i.h)("div",{class:"s-verify-message",innerHTML:salla.lang.get("pages.profile.verify_message")}),(0,i.h)("input",{type:"hidden",name:"code",maxlength:"4",required:!0,ref:e=>this.code=e}),(0,i.h)("div",{class:"s-verify-codes",dir:"ltr"},[1,2,3,4].map((()=>(0,i.h)("input",{type:"text",maxlength:"1",class:"s-verify-input",required:!0})))),(0,i.h)("div",{slot:"footer",class:"s-verify-footer"},(0,i.h)("salla-button",{class:"s-verify-submit","loader-position":"center",disabled:!0,onClick:()=>this.submit(),ref:e=>this.btn=e},salla.lang.get("pages.profile.verify")),(0,i.h)("p",{class:"s-verify-resend-message",ref:e=>this.resendMessage=e},salla.lang.get("blocks.header.resend_after"),(0,i.h)("b",{class:"s-verify-timer",ref:e=>this.timer=e})),(0,i.h)("a",{href:"#",class:"s-verify-resend",onClick:()=>this.resendCode(),ref:e=>this.resend=e},salla.lang.get("blocks.comments.submit"))),(0,i.h)("slot",{name:"after-footer"}))}get host(){return(0,i.g)(this)}};a.style="salla-verify{display:block}"}}]);